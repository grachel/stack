<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="home/layout">
<head>
    <title>Stack Application - [[${post.getTitle()}]]</title>
</head>
<body>
<div layout:fragment="content" class="content">
    <h2>[[${post.getTitle()}]]</h2>
    <h5><span class="glyphicon glyphicon-time"></span>Posted by [[${post.getOwner().getDisplayName()}]], [[${post.getCreationDate()}]].</h5>
    <p>[[${post.getBody()}]]</p>
    <hr>


    <div class="comments">
        <ul th:each="comment : ${post.getCommentaries()}">
            <li id="${comment.getId()}" class="score">[[${comment.getScore()}]]</li>
            <li>[[${comment.getBody()}]]</li>
            <li>[[${comment.getCreationdate()}]]</li>
            <li>[[${comment.getUsersByUserid().getDisplayname()}]]</li>
        </ul>
    </div>
    <h4>Leave a Comment:</h4>
    <form role="form">
        <div class="form-group">
            <textarea id="textareaID" class="form-control" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-success">Submit</button>
    </form>
    <br><br>

    <script th:inline="javascript">
        /*<![CDATA[*/

        $(document).ready(function(){
            console.log("xxxx")
            $("button").click(function(){
                console.log(1 + $("#textareaID").val())
                $.ajax({
                    type: "POST",
                    url: "/comment",
                    data: { postid: [[${post.getId()}]], body: $("#textareaID").val() },
                    done :
                        function(comment){
                            $( ".comments" ).append(
                                "<ul><li>"
                                + comment.getScore()
                                + "</li><li>"
                                + comment.getBody()
                                + "</li><li>"
                                + comment.getCreationdate()
                                + "</li><li>"
                                + comment.getUsersByUserid().getDisplayname()
                                + "</li></ul>" );
                        }
                });
            });
        });

        $(document).ready(function(){
            $( ".score" ).click(function(event) {
                $.ajax({
                    type: "POST",
                    url: "score",
                    data: {xxx: event.target.id},
                    success: function (score) {
                        $(".score").val(score);
                    }
                });
            });
        });

        /*]]>*/

    </script>
</div>
</body>
</html>
