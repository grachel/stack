<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout">
<head>
    <title>Stack Application - [[${post.getTitle()}]]</title>
</head>
<body>
<div layout:fragment="content" class="content">
    <h2>[[${post.getTitle()}]]</h2>
    <h5><span class="glyphicon glyphicon-time"></span>Posted by [[${post.getOwner().getDisplayName()}]], [[${post.getCreationDate()}]].</h5>
    <p>[[${post.getBody()}]]</p>
    <hr>


    <div class="comments">
        <ul th:each="comment : ${post.getCommentaries()}">
            <li id="${comment.getId()}" class="score">[[${comment.getScore()}]]</li>
            <li>[[${comment.getBody()}]]</li>
            <li>[[${comment.getCreationdate()}]]</li>
            <li>[[${comment.getUsersByUserid().getDisplayname()}]]</li>
        </ul>
    </div>
    <h4>Leave a Comment:</h4>
    <form role="form">
        <div class="form-group">
            <textarea id="textareaID" class="form-control" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-success">Submit</button>
    </form>
    <br><br>

    <script th:inline="javascript">
        $(document).ready(function(){
            $("button").click(function(){
                $.post("comment",
                {
                  postid: /*[[${post.getId()}]]*/,
                  body: $("#textareaID").val()
                },
                function(comment){
                    $( ".comments" ).append(
                    "<ul>
                        <li>" + comment.getScore() + "</li>
                        <li>" + comment.getBody() + "</li>
                        <li>" + comment.getCreationdate() + "</li>
                        <li>" + comment.getUsersByUserid().getDisplayname() + "</li>
                    </ul>" );
                });
            });
        });

        $(document).ready(function(){
            $( ".score" ).click(function(event) {
                 $.post("score",
                    {
                      id: event.target.id
                    },
                    function(score){
                        $(".score").val(score);
                    });
            });
        });
    </script>
</div>
</body>
</html>
